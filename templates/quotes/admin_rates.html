{% extends 'base.html' %}
{% block title %}Tarifas por origen{% endblock %}
{% block content %}
<style>
    .rates-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 14px;
    }
    .rates-card {
        border: 1px solid var(--border);
        border-radius: 14px;
        background: #fff;
        padding: 16px;
    }
    .rates-card h2 {
        margin-bottom: 4px;
    }
    @media (max-width: 900px) {
        .rates-grid { grid-template-columns: 1fr; }
    }
</style>

<div class="page-title">
    <h1>Tarifas por origen</h1>
    <p class="subtle">Crea aeropuertos y puertos, luego define una tarifa unica. La vigencia se gestiona automaticamente.</p>
</div>

<div class="rates-grid section">
    <section class="rates-card">
        <h2>Crear origen</h2>
        <p class="muted">Registra aeropuerto o puerto disponible para cotizar.</p>
        <form method="post">
            {% csrf_token %}
            {{ location_form.as_p }}
            <div class="actions">
                <button class="btn" type="submit" name="create_location" value="1">Crear origen</button>
            </div>
        </form>
    </section>

    <section class="rates-card">
        <h2>Crear tarifa</h2>
        <p class="muted">La tarifa se aplica igual para KG o M3. Al crear una nueva, se cierra la anterior.</p>
        <form method="post">
            {% csrf_token %}
            {{ rate_form.as_p }}
            <div class="actions">
                <button class="btn" type="submit" name="create_rate" value="1">Guardar tarifa</button>
                <a class="btn btn-secondary" href="{% url 'quotes:admin_panel' %}">Volver al panel</a>
            </div>
        </form>
    </section>
</div>

<div class="section">
    <h2>Aeropuertos</h2>
    <table>
        <thead>
            <tr>
                <th>Codigo</th>
                <th>Nombre</th>
                <th>Pais</th>
                <th>Estado</th>
                <th>Tarifa vigente USD</th>
                <th>Vigencia</th>
            </tr>
        </thead>
        <tbody>
            {% for location, rate in airports_with_rates %}
            <tr>
                <td>{{ location.code }}</td>
                <td>{{ location.name }}</td>
                <td>{{ location.country }}</td>
                <td>{% if location.is_active %}Activo{% else %}Inactivo{% endif %}</td>
                <td>{% if rate %}{{ rate.rate_usd }}{% else %}-{% endif %}</td>
                <td>{% if rate %}{{ rate.effective_from }}{% if rate.effective_to %} a {{ rate.effective_to }}{% else %} en adelante{% endif %}{% else %}-{% endif %}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No hay aeropuertos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>

<div class="section">
    <h2>Puertos</h2>
    <table>
        <thead>
            <tr>
                <th>Codigo</th>
                <th>Nombre</th>
                <th>Pais</th>
                <th>Estado</th>
                <th>Tarifa vigente USD</th>
                <th>Vigencia</th>
            </tr>
        </thead>
        <tbody>
            {% for location, rate in seaports_with_rates %}
            <tr>
                <td>{{ location.code }}</td>
                <td>{{ location.name }}</td>
                <td>{{ location.country }}</td>
                <td>{% if location.is_active %}Activo{% else %}Inactivo{% endif %}</td>
                <td>{% if rate %}{{ rate.rate_usd }}{% else %}-{% endif %}</td>
                <td>{% if rate %}{{ rate.effective_from }}{% if rate.effective_to %} a {{ rate.effective_to }}{% else %} en adelante{% endif %}{% else %}-{% endif %}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="6">No hay puertos registrados.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% endblock %}
